<div>
  <table id="rehabilitationAidsContainer" class="table table-bordered">
    <thead>
      <tr>
        <th>Name</th>
        <th>More Details</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Complaint Row Template -->
      <tr class="rehabilitation-aids-row">
        <!-- Complaint Input -->
        <td>
          <input
            type="text"
            class="form-control rehabilitation-aids-input"
            id="rehabilitation-aids-input"
            placeholder="Enter Complaint"
            list="rehabilitation-aidsSuggestions"
          />
          <!-- Suggestions -->
          <datalist id="rehabilitation-aidsSuggestions"></datalist>
        </td>

        <td>
          <input
            type="text"
            class="form-control moredetail-input"
            id="moredetail"
            placeholder="Enter More Detail"
          />
        </td>

        <!-- Remove Button -->
        <td>
          <button
            type="button"
            class="btn btn-danger remove-rehabilitation-aids"
          >
            Remove
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Button to add new rehabilitation-aids -->
  <div class="d-flex justify-content-end">
    <button id="addRehabilitationAidsBtn" class="btn btn-primary mt-1">
      Add Rehabilitation Aids
    </button>
  </div>
</div>

<script>
  $(document).ready(function () {
    let rehabilitationaidsData = {};

    // Fetch rehabilitation aids and populate datalist
    async function init() {
      try {
        const rehabilitationaids =
          await window.electronAPI.getRehabilitationAids();
        const dataList = $("#rehabilitation-aidsSuggestions");
        dataList.empty();

        rehabilitationaids.forEach((rehabilitationaid) => {
          rehabilitationaidsData[rehabilitationaid.name] = rehabilitationaid;
          dataList.append(
            `<option value="${rehabilitationaid.name}"></option>`
          );
        });
      } catch (error) {
        console.error("Error fetching rehabilitation aids:", error);
      }
    }

    $(document).on("click", ".remove-rehabilitation-aids", function () {
      event.preventDefault();
      $(this).closest("tr").remove();
    });

    // Add new row button
    $("#addRehabilitationAidsBtn").on("click", function (event) {
      init();
      event.preventDefault();
      newRowHtml = common.getRehabilitationAidRow();
      $("#rehabilitationAidsContainer tbody").append(newRowHtml);
    });

    $(document).on("input", ".rehabilitation-aids-input", function () {
      const selectedRehabilitationAids = $(this).val();
      const rehabilitationRow = $(this).closest("tr");

      if (rehabilitationaidsData[selectedRehabilitationAids]) {
        const rehabilitationAidDetails =
          rehabilitationaidsData[selectedRehabilitationAids];

        // Find elements with IDs that start with "moredetail" and update the value
        rehabilitationRow
          .find("[id^='moredetail']") // Find elements whose ID starts with "moredetail"
          .val(rehabilitationAidDetails.moredetail); // Set more details
      }
    });

    init();
  });
</script>
